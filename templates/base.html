<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<nav class="navbar">
    <h1>ğŸ“š Student Management</h1>
    <ul>
        <!-- Home: visible to all logged-in users -->
        {% if session.get("user_email") %}
            <li><a href="{{ url_for('index') }}">Home</a></li>
        {% endif %}

        <!-- Student Search (Admin, Auditor, Superadmin) -->
        {% if session.get("role") in ["admin", "auditor", "superadmin"] %}
            <li><a href="{{ url_for('search_students') }}">ğŸ” Search</a></li>
        {% endif %}

        <!-- ADMIN & SUPERADMIN: Reports -->
        {% if session.get("role") in ["admin", "superadmin", "auditor"] %}
            <li><a href="{{ url_for('dashboard_summary') }}">ğŸ  Dashboard</a></li>
            <li><a href="{{ url_for('reports') }}">ğŸ“Š Reports</a></li>
        {% endif %}

        <!-- User Profile Dropdown Icon (Right aligned) -->
        {% if session.get("user_email") %}
            <li style="margin-left:auto;">
                <div class="user-menu-dropdown" id="userMenuDropdown">
                    <button class="user-icon-btn" onclick="toggleUserMenu(event)">ğŸ‘¤</button>
                    <div class="user-dropdown-content" id="userDropdownContent">
                        <div class="dropdown-header">
                            <strong>{{ session.get("user_email") }}</strong>
                            <span class="role-badge">{{ session.get("role") }}</span>
                        </div>
                        <hr class="dropdown-divider">
                        
                        <!-- ADMIN OPTIONS -->
                        {% if session.get("role") == "admin" %}
                            <a href="{{ url_for('add_student') }}">â• Add Student</a>
                            <a href="{{ url_for('bulk_upload_students') }}">ğŸ“¤ Bulk Upload</a>
                            <hr class="dropdown-divider">
                        {% endif %}

                        <!-- SUPERADMIN OPTIONS -->
                        {% if session.get("role") == "superadmin" %}
                            <a href="{{ url_for('view_approvals') }}">ğŸ“‹ Approvals</a>
                            <a href="{{ url_for('bulk_approval') }}">âœ… Bulk Approval</a>
                            <a href="{{ url_for('request_timeline') }}">ğŸ“… Request History</a>
                            <a href="{{ url_for('approval_audit') }}">ğŸ“Š Approval Audit</a>
                            <a href="{{ url_for('activity_report') }}">ğŸ“ˆ User Activity</a>
                            <a href="{{ url_for('user_management') }}">ğŸ‘¤ User Management</a>
                            <a href="{{ url_for('account_activation') }}">ğŸ” Account Activation</a>
                            <a href="{{ url_for('account_deletion') }}">ğŸ—‘ï¸ Account Deletion</a>
                            <a href="{{ url_for('permission_assignment') }}">ğŸ”’ Permissions</a>
                            <a href="{{ url_for('audit_logs') }}">ğŸ“ Audit Logs</a>
                            <a href="{{ url_for('activity_log_viewer') }}">ğŸ“Š Activity Logs</a>
                            <a href="{{ url_for('system_health') }}">ğŸ’ª System Health</a>
                            <a href="{{ url_for('ip_management') }}">ğŸŒ IP Management</a>
                            <a href="{{ url_for('session_management') }}">ğŸ’» Session Management</a>
                            <a href="{{ url_for('security_configuration') }}">ğŸ” Security Config</a>
                            <a href="{{ url_for('manage_roles') }}">ğŸ‘¥ Change Roles</a>
                            <hr class="dropdown-divider">
                        {% endif %}

                        <!-- AUDITOR OPTIONS -->
                        {% if session.get("role") == "auditor" %}
                            <a href="{{ url_for('recycle_bin') }}">ğŸ—‘ï¸ Recycle Bin</a>
                            <a href="{{ url_for('logs') }}">ğŸ“ Activity Logs</a>
                            <hr class="dropdown-divider">
                        {% endif %}

                        <!-- COMMON OPTIONS -->
                        <a href="{{ url_for('setup_2fa') }}">âš™ï¸ Settings (2FA)</a>
                        <a href="{{ url_for('notification_preferences') }}">ğŸ”” Notifications</a>
                        <a href="{{ url_for('remove_logged_account') }}" class="danger-link">ğŸ—‘ï¸ Delete Account</a>
                        <a href="{{ url_for('logout') }}">ğŸšª Logout</a>
                    </div>
                </div>
            </li>
        {% else %}
            <!-- Not logged in -->
            <li style="margin-left:auto;">
                <a href="{{ url_for('login') }}">Login</a>
            </li>
        {% endif %}
    </ul>
</nav>

<div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <p class="msg {{ category }}">{{ message }}</p>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
</div>

<script>
    function toggleUserMenu(event) {
        event.preventDefault();
        event.stopPropagation();
        const dropdown = document.getElementById('userDropdownContent');
        dropdown.classList.toggle('active');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('userMenuDropdown');
        if (dropdown && !dropdown.contains(event.target)) {
            document.getElementById('userDropdownContent').classList.remove('active');
        }
    });

    // Close dropdown when a link is clicked
    document.querySelectorAll('.user-dropdown-content a').forEach(link => {
        link.addEventListener('click', function() {
            document.getElementById('userDropdownContent').classList.remove('active');
        });
    });
</script>

</body>
</html>
