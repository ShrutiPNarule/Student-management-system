{% extends "base.html" %}
{% block content %}

<div class="auth-wrapper">
  <div class="auth-card">
    <h2 class="auth-title">Login</h2>
    <p class="auth-subtitle">Sign in with your registered email address</p>

    <!-- ‚úÖ TC_LOGIN_034: ARIA live region for messages -->
    <div id="flash-messages" role="alert" aria-live="polite" aria-atomic="true" style="display:none;"></div>

    <form method="post" class="auth-form" autocomplete="on">

      <!-- EMAIL -->
      <div class="auth-field">
        <label for="email">Email (Username)</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          maxlength="254"
          placeholder="user@example.com"
          aria-describedby="email-help"
        >
        <div id="email-length-warning" style="display:none; color:orange; font-size:0.9em;">
          ‚ö†Ô∏è Email length is close to maximum (254 characters)
        </div>
      </div>

      <!-- PASSWORD -->
      <div class="auth-field">
        <label for="password">Password</label>
        <div style="position: relative;">
          <input
            type="password"
            id="password"
            name="password"
            required
            maxlength="128"
            aria-describedby="pwd-help"
          >
          <!-- ‚úÖ TC_LOGIN_034: Accessible password toggle with ARIA labels -->
          <button
            type="button"
            id="password-toggle"
            onclick="togglePassword()"
            aria-label="Toggle password visibility"
            aria-pressed="false"
            style="background:none; border:none; cursor:pointer; position:absolute; right:10px; top:50%; transform:translateY(-50%); padding:5px;"
            title="Show / Hide Password"
          >
            üëÅÔ∏è
          </button>
        </div>
        <div id="pwd-length-warning" style="display:none; color:orange; font-size:0.9em;">
          ‚ö†Ô∏è Password length is close to maximum (128 characters)
        </div>
      </div>

      <!-- REMEMBER ME -->
      <div class="auth-field">
        <label>
          <input type="checkbox" name="remember_me" aria-label="Remember me for 30 days">
          Remember Me (30 days)
        </label>
      </div>

      <!-- SUBMIT -->
      <button type="submit" class="btn btn-primary auth-btn">
        Login
      </button>

      <!-- FORGOT PASSWORD -->
      <div class="auth-link">
        <a href="{{ url_for('forgot_password') }}">Forgot Password?</a>
      </div>

      <!-- REGISTER -->
      <div class="auth-link">
        <span>Don't have an account?</span>
        <a href="{{ url_for('register') }}">Register here</a>
      </div>
    </form>
  </div>
</div>

<script>
function togglePassword() {
  const btn = document.getElementById("password-toggle");
  const pwd = document.getElementById("password");
  const isHidden = pwd.type === "password";
  pwd.type = isHidden ? "text" : "password";
  // ‚úÖ TC_LOGIN_034: Update ARIA pressed state
  btn.setAttribute("aria-pressed", isHidden ? "true" : "false");
  btn.setAttribute("aria-label", isHidden ? "Hide password" : "Show password");
}

// ‚úÖ TC_LOGIN_009, TC_LOGIN_010: Monitor input length
document.getElementById("email").addEventListener("input", function() {
    if (this.value.length > 240) {
        document.getElementById("email-length-warning").style.display = "block";
    } else {
        document.getElementById("email-length-warning").style.display = "none";
    }
});

document.getElementById("password").addEventListener("input", function() {
    if (this.value.length > 115) {
        document.getElementById("pwd-length-warning").style.display = "block";
    } else {
        document.getElementById("pwd-length-warning").style.display = "none";
    }
});
</script>

{% endblock %}
