{% extends "base.html" %}
{% block content %}

{% if session.get("role") == "superadmin" %}

<div class="form-card" style="max-width: 900px; margin: 0 auto;">
    <h2>Account Activation & Deactivation</h2>

    <form method="GET" novalidate>
        <div class="form-row">
            <div class="form-group">
                <label>Search User</label>
                <input type="text" name="search" placeholder="Name or Email" value="{{ request.args.get('search', '') }}">
            </div>

            <div class="form-group">
                <label>Status</label>
                <select name="status_filter">
                    <option value="">-- All --</option>
                    <option value="active" {% if request.args.get('status_filter') == 'active' %}selected{% endif %}>Active</option>
                    <option value="inactive" {% if request.args.get('status_filter') == 'inactive' %}selected{% endif %}>Inactive</option>
                </select>
            </div>

            <div class="form-group">
                <label>Role</label>
                <select name="role_filter">
                    <option value="">-- All Roles --</option>
                    <option value="student" {% if request.args.get('role_filter') == 'student' %}selected{% endif %}>üë®‚Äçüéì Student (Self-service)</option>
                    <option value="admin" {% if request.args.get('role_filter') == 'admin' %}selected{% endif %}>üë®‚Äçüíº Admin (View, Log, Approve)</option>
                    <option value="auditor" {% if request.args.get('role_filter') == 'auditor' %}selected{% endif %}>üîç Auditor (View, Log)</option>
                    <option value="clerk" {% if request.args.get('role_filter') == 'clerk' %}selected{% endif %}>üìã Clerk (Data Entry)</option>
                    <option value="superadmin" {% if request.args.get('role_filter') == 'superadmin' %}selected{% endif %}>üëë Superadmin (Oversight)</option>
                </select>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>

    <h3 style="margin-top: 30px;">User Accounts</h3>
    
    {% if users %}
    <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
        <thead>
            <tr style="background-color: #3F4F5F; color: white;">
                <th>User ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Status</th>
                <th>Created Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid #ddd;">
                <td>{{ user[0] }}</td>
                <td>{{ user[1] }}</td>
                <td>{{ user[2] }}</td>
                <td>{{ user[3] or 'N/A' }}</td>
                <td>{{ user[4] or 'No Role' }}</td>
                <td>
                    {% if user[5] == 'active' %}
                        <span style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 3px;">Active</span>
                    {% else %}
                        <span style="background: #f44336; color: white; padding: 5px 10px; border-radius: 3px;">Inactive</span>
                    {% endif %}
                </td>
                <td>{{ user[6] }}</td>
                <td>
                    <form method="POST" style="display: inline;">
                        <input type="hidden" name="user_id" value="{{ user[0] }}">
                        {% if user[5] == 'active' %}
                            <button type="submit" name="action" value="deactivate" class="btn btn-sm btn-danger" 
                                    onclick="return confirm('Deactivate this account? User will not be able to login.');">
                                Deactivate
                            </button>
                        {% else %}
                            <button type="submit" name="action" value="activate" class="btn btn-sm btn-success" 
                                    onclick="return confirm('Activate this account? User will be able to login.');">
                                Activate
                            </button>
                        {% endif %}
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="margin-top: 20px; color: #666;">No accounts found matching your criteria.</p>
    {% endif %}
</div>

<style>
.btn {
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 13px;
}

.btn-success {
    background: #4CAF50;
    color: white;
}

.btn-success:hover {
    background: #45a049;
}

.btn-danger {
    background: #f44336;
    color: white;
}

.btn-danger:hover {
    background: #da190b;
}

.btn-sm {
    padding: 5px 10px;
    font-size: 12px;
}
</style>

{% else %}
<h3 style="color:red;">Unauthorized Access</h3>
<a href="{{ url_for('index') }}" class="btn btn-secondary">Go Back</a>
{% endif %}

{% endblock %}
